<!DOCTYPE html>
    <html lang="en">
        <title>Takeaway Decider Wheel</title>
        <script src='Winwheel.js'></script> <!-- script library for Winwheel from http://dougtesting.net/ -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.4/gsap.min.js"></script> <!-- Use of Greenstock Animation Platform from https://greensock.com/ -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5NYWqZ40UfU1uCPpWqr-PCeYhtlA1KVE&callback=initMap&libraries=geometry,places"></script>
    <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="canvasContainer">
            <canvas id="canvas" width="500" height="500"> <!-- Wheel container size -->
            </canvas>
            <img id="prizePointer" src="assets/images/prizepointer.png" alt="prize pointer" /> <!-- Pointer image -->
        </div>
        <button id="spinButton" style="display: inline;" onClick="spinClick(); theWheel.startAnimation(); initMap();">Spin the Wheel</button> <!-- Spin wheel by calling startAnimation, initMap function resets map so new winning text search each time -->
<button id="resetButton" style="display: none;" onClick="resetWheel();">Reset</button>
<div id="map" style="display: none;"></div>
        <script>


    var map;     // Declare variables.
    var service;
    var infowindow;

function spinClick() {                                                        // Spin Button toggle on and off.
  var spinClick = document.getElementById("spinButton");
  if (spinButton.style.display === "inline") {
    spinButton.style.display = "none";
  } else {
    spinButton.style.display = "inline";
  }
}

function reset() {                                                        // Reset Button toggle on and off.
  var reset = document.getElementById("resetButton");
  if (resetButton.style.display === "none") {
    resetButton.style.display = "block";
  } else {
    resetButton.style.display = "none";
  }
}

function mapView() {                                                        // Map in view toggle on and off.
  var mapView = document.getElementById("map");
  if (mapView.style.display === "none") {
    mapView.style.display = "block";
  } else {
    mapView.style.display = "none";
  }
}

function initMap() {                                                         // Initialise map to home location(ratoath).
  var map = new google.maps.Map(
      document.getElementById('map'), {zoom: 15, center: {lat: 53.508709, lng: -6.460100},});

  var request = {                                                           
    location: {lat: 53.508709, lng: -6.460100},                             // Coordinates of results centre point.
    radius: '10',                                                           // Radius in from results centre point.
    query: [winningSegment.text],                                                       // Text to be searched.
  };

  service = new google.maps.places.PlacesService(map);
  service.textSearch(request, callback);
}

function callback(results, status) {                                        
  if (status == google.maps.places.PlacesServiceStatus.OK) {
    for (var i = 0; i < 5; i++) {
      var place = results[i];                                               // For loop through results.
      createMarker(results[i]);                                             // Add maker for each result.
      console.log(results[i]);                                              // Log results to console.                                    
    }
  }
}
 
 function createMarker(place) {

    new google.maps.Marker({
        position: place.location,
        map: map,
    });
}



    let theWheel = new Winwheel({
                'numSegments' : 6, // Number of segments.
                'textAlignment'  : 'inner', // Text alignment.
                'outerRadius'   : 200, // Radius of outer circle.
                'pointerAngle' : 90, // Degree angle that pointer sits at.
                'innerRadius'   : 40, // Radius of inner circle.
                'segments'    : // Individual segment styling.
                [
                    {'fillStyle' : '#eeefff', 'text' : 'Burger'},
                    {'fillStyle' : '#89f26e', 'text' : 'pizza'},
                    {'fillStyle' : '#7de6ef', 'text' : 'Chips'},
                    {'fillStyle' : '#e7706f', 'text' : 'Chinese'},
                    {'fillStyle' : '#eff111', 'text' : 'Indian'},
                    {'fillStyle' : '#e77811', 'text' : 'Pizza'}
                ],
               'pins' :    // Specify pin parameters.
        {
            'number'      : 24,  // Number of pins.
            'outerRadius' : 5,  // Radius of each pin.
            'margin'      : 5,  // Margin ofpin from edge of wheel.
            'fillStyle'   : '#636363', // Fill colour of pin.
            'strokeStyle' : '#ffffff' // Border colour of pin.
        },
            'animation' :
            {
        'type'     : 'spinToStop',  // Animation set to spin and then stop.
        'duration' : 4,             // Animation  time in seconds.
        'spins'    : 6,              // Number of complete revolutions of the wheel.
        'callbackFinished' : 'winAnimation(), mapView()' // After spinning finishes, play winning animation & display map
        
        }
    });

        function winAnimation()
        {
            var winningSegment = theWheel.getIndicatedSegment();                // Get the text of the winning segment.
            var winningSegmentNumber = theWheel.getIndicatedSegmentNumber();    // Get the number of the winning segment.
 
            for (let i = 1; i < theWheel.segments.length; i ++) 
            {
                theWheel.segments[i].fillStyle = 'grey';                     // For loop and change fillStyle of all segments to grey.
            }

            theWheel.segments[winningSegmentNumber].fillStyle = 'gold';     // Change winning segment colour.
 
            theWheel.draw();                                                // Call draw function to render changes.
            reset();
            console.log(winningSegment.text);                           // Console logs the text of winning segment.
            console.log(typeof winningSegment);
        }

        function resetWheel()
        {
            theWheel.stopAnimation(false);  // Stop the animation, false as param so does not call callback function.
            theWheel.rotationAngle = 0;     // Re-set the wheel angle to 0 degrees.
            theWheel.segments[1].fillStyle = '#eeefff';
            theWheel.segments[2].fillStyle = '#89f26e',
            theWheel.segments[3].fillStyle = '#7de6ef',
            theWheel.segments[4].fillStyle = '#e7706f',
            theWheel.segments[5].fillStyle = '#eff111',
            theWheel.segments[6].fillStyle = '#e77811';
            theWheel.draw();                // Call draw function to render changes.
            mapView();                      // Toggle mapView function to reset map to hidden.
            spinClick();                    // Toggle Spin button to On.
            reset();                        // Toggle Reset button to Off.
            };
              
</script>
    </body>
</html>