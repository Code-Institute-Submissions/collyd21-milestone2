<!DOCTYPE html>
    <html lang="en">
        <title>Takeaway Decider Wheel</title>
        <script src='Winwheel.js'></script> <!-- script library for Winwheel from http://dougtesting.net/ -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.2.4/gsap.min.js"></script> <!-- Use of Greenstock Animation Platform from https://greensock.com/ -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5NYWqZ40UfU1uCPpWqr-PCeYhtlA1KVE&callback=initMap&libraries=geometry,places&amp"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    </head>
    <body>
        
        <div class="container-fluid no-gutters">
  <div class="row">
    <div class="text-right col-2">
    <button class="btn btn-success" id="spinButton" style="display: inline;" onClick="spinClick(); theWheel.startAnimation(); initGeolocation();">Spin the Wheel</button> <!-- Spin wheel by calling startAnimation, initMap function and spinClick function --> 
    </div> <!-- Column 1-->
    <div id="wheelCol" class="col-8">
        <canvas id="canvas" text-align= "center" width="620" height="620"> 
            </canvas> 
        </div> <!-- Column 2-->
    <div class="text-left col-2">
    <button class="btn btn-danger" id="resetButton" style="display: none;" onClick="resetWheel();">Reset</button> <!-- Reset wheel calling reset function -->
    </div> <!-- Column 3-->
        </div> <!-- Row 1-->
        </div> <!-- Container 1-->    
        <div class="container-fluid no-gutters">
        <div class="row">
        <div class="col" id="map" style="display: none;"></div>
        </div> <!-- Column 4-->
        </div>  <!-- Row 2-->
        </div> <!-- Container 2-->
        
        <script type="text/javascript">
            function initGeolocation() {
                if (navigator.geolocation) {

                    // Call getCurrentPosition with success and failure callbacks
                    navigator.geolocation.getCurrentPosition(success, fail);
                } else {
                    alert("Sorry, your browser does not support geolocation services.");
                }
            }
            var map;
            var service;

            function handleSearchResults(results, status) {
                console.log(results);

                for (var i = 0; i < results, length; i++) {
                    var marker = new google.maps.Marker({
                        position: results(i).geometry.location,
                        map: map
                    });
                }

            }

            function performSearch() {
                var request = {
                    bounds: map.getBounds(),
                    name: ['winningSegment.text']
                }

                service.nearbySearch(request, handleSearchResults);
            }

            function success(position) {
                var coords = new google.maps.LatLng(position.coords.latitude, position.coords.longitude); // Define the coordinates

                var mapOptions = {
                    zoom: 16,
                    center: coords,
                };

                map = new google.maps.Map(document.getElementById("map"), mapOptions);  // Create the map

                var marker = new google.maps.Marker({                               // Place the initial marker
                    position: coords,
                    map: map,
                    title: "Your current location!"
                });
                marker.setMap(map);

                service = new google.maps.places.PlacesService(map);

                google.maps.event.addListenerOnce(map, 'bounds_changed', performSearch);
            }

            function fail() {                                                       // Could not obtain location
            }

            function placesRequest(title, latlng, radius, types, icon) {            //Request places from Google
                var request = {                                                     //Parameters for our places request
                    location: latlng,
                    radius: radius,
                    types: types
                };
                
                var callPlaces = new google.maps.places.PlacesService(map);         //Make the service call to google
                callPlaces.search(request, function (results, status) {
                    $.each(results, function (i, place) {                           //trace what Google gives us back
                        var placeLoc = place.geometry.location;
                        var thisplace = new google.maps.Marker({
                            map: map,
                            position: place.geometry.location,
                            icon: icon,
                            title: place.name
                        });
                    })
                });

            }

function spinClick() {                                                        // Spin Button toggle on and off.
  var spinClick = document.getElementById("spinButton");
  if (spinButton.style.display === "inline") {
    spinButton.style.display = "none";
  } else {
    spinButton.style.display = "inline";
  }
}

function reset() {                                                        // Reset Button toggle on and off.
  var reset = document.getElementById("resetButton");
  if (resetButton.style.display === "none") {
    resetButton.style.display = "block";
  } else {
    resetButton.style.display = "none";
  }
}

function mapView() {                                                        // Map in view toggle on and off.
  var mapView = document.getElementById("map");
  if (mapView.style.display === "none") {
    mapView.style.display = "block";
  } else {
    mapView.style.display = "none";
  }
}
    let theWheel = new Winwheel({
                'numSegments' : 6,                              // Number of segments.
                'textAlignment'  : 'centre',                     // Text alignment.
                'textMargin' : 0,
                'outerRadius'   : 300,                          // Radius of outer circle.
                'pointerAngle' : 90,                            // Degree angle that pointer sits at.
                'innerRadius'   : 40,                           // Radius of inner circle.
                'textFontSize'  : 40,
                'segments'    :                                 // Individual segment styling.
                [
                    {'fillStyle' : '#eeefff', 'text' : 'Burger'},
                    {'fillStyle' : '#89f26e', 'text' : 'pizza'},
                    {'fillStyle' : '#7de6ef', 'text' : 'Chips'},
                    {'fillStyle' : '#e7706f', 'text' : 'Chinese'},
                    {'fillStyle' : '#eff111', 'text' : 'Indian'},
                    {'fillStyle' : '#e77811', 'text' : 'Pizza'}
                ],
               'pins' :    // Specify pin parameters.
        {
            'number'      : 24,  // Number of pins.
            'outerRadius' : 8,  // Radius of each pin.
            'margin'      : 10,  // Margin ofpin from edge of wheel.
            'fillStyle'   : '#636363', // Fill colour of pin.
            'strokeStyle' : '#ffffff' // Border colour of pin.
        },
            'animation' :
            {
        'type'     : 'spinToStop',  // Animation set to spin and then stop.
        'duration' : 4,             // Animation  time in seconds.
        'spins'    : 6,              // Number of complete revolutions of the wheel.
        'callbackFinished' : 'winAnimation(), mapView()' // After spinning finishes, play winning animation & display map
        
        }
    });

        function winAnimation()
        {
            var winningSegment = theWheel.getIndicatedSegment();                // Get the text of the winning segment.
            var winningSegmentNumber = theWheel.getIndicatedSegmentNumber();    // Get the number of the winning segment.
 
            for (let i = 1; i < theWheel.segments.length; i ++) 
            {
                theWheel.segments[i].fillStyle = 'grey';                     // For loop and change fillStyle of all segments to grey.
            }

            theWheel.segments[winningSegmentNumber].fillStyle = 'gold';     // Change winning segment colour.
            theWheel.pins.fillStyle   = '#97EFE9';
            theWheel.draw();                                                // Call draw function to render changes.
            reset();
            console.log(winningSegment.text);                           // Console logs the text of winning segment.
            console.log(typeof winningSegment.text);
        }

        function resetWheel()
        {
            theWheel.stopAnimation(false);  // Stop the animation, false as param so does not call callback function.
            theWheel.rotationAngle = 0;     // Re-set the wheel angle to 0 degrees.
            theWheel.segments[1].fillStyle = '#eeefff';
            theWheel.segments[2].fillStyle = '#89f26e';
            theWheel.segments[3].fillStyle = '#7de6ef';
            theWheel.segments[4].fillStyle = '#e7706f';
            theWheel.segments[5].fillStyle = '#eff111';
            theWheel.segments[6].fillStyle = '#e77811';       
            theWheel.pins.fillStyle   = '#636363';
            theWheel.draw();                // Call draw function to render changes.
            mapView();                      // Toggle mapView function to reset map to hidden.
            spinClick();                    // Toggle Spin button to On.
            reset();                        // Toggle Reset button to Off.
            };
              
</script>
    </body>
</html>